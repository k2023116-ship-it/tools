<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Viral Meme Creator | Gemini</title>
  <style>
    body{margin:0;font-family:sans-serif;background:#0d1117;color:#f0f6fc}
    header{padding:20px;text-align:center;background:#161b22}
    h1{margin:0;color:#58a6ff}
    main{max-width:1000px;margin:20px auto;padding:20px}
    .card{background:#161b22;padding:16px;border-radius:12px;margin-bottom:20px}
    input,select,button{width:100%;padding:10px;margin-top:8px;border-radius:8px;border:1px solid #30363d;background:#0d1117;color:#fff}
    button{cursor:pointer;font-weight:600}
    .primary{background:#58a6ff;color:#0b1220}
    .output{margin-top:10px;padding:10px;border-radius:8px;background:#0d1117;border:1px solid #30363d}
    .list-item{padding:6px 10px;margin:4px 0;background:#0d1117;border:1px solid #30363d;border-radius:6px;cursor:pointer}
    .list-item:hover{background:#222f3a}
    canvas{max-width:100%;margin-top:15px;border:1px solid #30363d;border-radius:12px}
  </style>
</head>
<body>
  <header>
    <h1>üòÇ Viral Meme Creator</h1>
    <p>Generate funny captions, templates & hashtags using Gemini</p>
  </header>

  <main>
    <div class="card">
      <label>Enter theme / keywords</label>
      <input id="theme" placeholder="e.g. student life, crypto losses"/>

      <label>Meme Style</label>
      <select id="style">
        <option>Gen Z</option>
        <option>Dark Humor</option>
        <option>Wholesome</option>
        <option>Sarcastic</option>
        <option>Relatable</option>
      </select>

      <button class="primary" id="btnGenerate">Generate Meme Ideas</button>
    </div>

    <div class="card">
      <h3>üé≠ Captions</h3>
      <div id="captions" class="output">‚ö° Captions will appear here...</div>
    </div>

    <div class="card">
      <h3>üñº Template Suggestions</h3>
      <div id="templates" class="output">‚ö° Templates will appear here...</div>
    </div>

    <div class="card">
      <h3>üè∑ Hashtags</h3>
      <div id="hashtags" class="output">‚ö° Hashtags will appear here...</div>
    </div>

    <div class="card">
      <h3>üé® Meme Builder</h3>
      <label>Select Template Image</label>
      <select id="templateSelect">
        <option value="https://i.imgflip.com/30b1gx.jpg">Drake Hotline Bling</option>
        <option value="https://i.imgflip.com/1ur9b0.jpg">Distracted Boyfriend</option>
        <option value="https://i.imgflip.com/26am.jpg">Grumpy Cat</option>
      </select>

      <label>Caption (click on a caption above to auto-fill)</label>
      <input id="captionInput" placeholder="Your funny caption..."/>

      <button class="primary" id="btnMakeMeme">Make Meme</button>
      <button class="primary" id="btnDownload">Download Meme</button>

      <canvas id="memeCanvas" width="500" height="500"></canvas>
    </div>
  </main>

  <script>
    const GEMINI_API_KEY = "AIzaSyDovzwxINfexpKQZC5K1TItqkhR-wp07yE";

    document.getElementById("btnGenerate").addEventListener("click", async ()=>{
      const theme = document.getElementById("theme").value.trim();
      const style = document.getElementById("style").value;
      const captionsEl = document.getElementById("captions");
      const templatesEl = document.getElementById("templates");
      const hashtagsEl = document.getElementById("hashtags");

      if(!theme){ captionsEl.textContent="‚ùå Please enter a theme."; return; }

      captionsEl.textContent="‚è≥ Generating...";
      templatesEl.textContent="";
      hashtagsEl.textContent="";

      try{
        const prompt = `
You are a viral meme expert.
Theme: "${theme}"
Style: "${style}"

Generate:
Captions: 5 short funny meme captions.
Templates: 3 popular meme templates.
Hashtags: 10 viral hashtags.

RULES:
- Output in plain text only.
- No asterisks, no markdown, no numbering.
- Separate each caption/template/hashtag with a new line.
        `;

        const res = await fetch(
          "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key="+GEMINI_API_KEY,
          {
            method:"POST",
            headers:{"Content-Type":"application/json"},
            body:JSON.stringify({
              contents:[{role:"user",parts:[{text:prompt}]}],
              generationConfig:{temperature:0.9,maxOutputTokens:800}
            })
          }
        );
        const data = await res.json();
        const text = data?.candidates?.[0]?.content?.parts?.[0]?.text || "";

        // simple split
        const [capBlock, rest] = text.split("Templates:");
        const [tempBlock, hashBlock] = (rest||"").split("Hashtags:");

        captionsEl.innerHTML = capBlock
          .replace("Captions:","").trim()
          .split("\n").filter(l=>l).map(c=>`<div class="list-item" onclick="useCaption('${c.replace(/'/g,"")}')">${c}</div>`).join("") || "‚ö†Ô∏è No captions.";

        templatesEl.innerHTML = (tempBlock||"").trim()
          .split("\n").filter(l=>l).map(t=>`<div class="list-item">${t}</div>`).join("") || "‚ö†Ô∏è No templates.";

        hashtagsEl.innerHTML = (hashBlock||"").trim()
          .split("\n").filter(l=>l).map(h=>`<span class="list-item">${h}</span>`).join(" ") || "‚ö†Ô∏è No hashtags.";

      }catch(err){
        captionsEl.textContent="‚ö†Ô∏è Error: "+err.message;
      }
    });

    // fill caption input on click
    function useCaption(text){
      document.getElementById("captionInput").value = text;
    }

    // Meme Builder
    document.getElementById("btnMakeMeme").addEventListener("click", ()=>{
      const canvas = document.getElementById("memeCanvas");
      const ctx = canvas.getContext("2d");
      const imgUrl = document.getElementById("templateSelect").value;
      const caption = document.getElementById("captionInput").value;

      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = ()=>{
        canvas.width = img.width;
        canvas.height = img.height;
        ctx.drawImage(img,0,0);

        ctx.font = "bold 36px Impact";
        ctx.fillStyle = "white";
        ctx.strokeStyle = "black";
        ctx.lineWidth = 4;
        ctx.textAlign = "center";

        // wrap text
        const words = caption.split(" ");
        let line="", lines=[], maxWidth=canvas.width-40;
        for(let w of words){
          const test = line+w+" ";
          if(ctx.measureText(test).width>maxWidth){
            lines.push(line);
            line=w+" ";
          }else line=test;
        }
        lines.push(line);

        let y=canvas.height-60-(lines.length*36)/2;
        for(let l of lines){
          ctx.strokeText(l, canvas.width/2, y);
          ctx.fillText(l, canvas.width/2, y);
          y+=40;
        }
      };
      img.src=imgUrl;
    });

    // Download meme
    document.getElementById("btnDownload").addEventListener("click", ()=>{
      const canvas = document.getElementById("memeCanvas");
      const link = document.createElement("a");
      link.download = "meme.png";
      link.href = canvas.toDataURL();
      link.click();
    });
  </script>
</body>
</html>
